{% extends "cast/layout.html" %}
{% block content %}


<!-- ===========================
BODY LEFT PART
============================ -->
<div class="col-md-8 mainleft">
    <div id="statement" class="row mobmid">
        <div class="col-sm-1">
            <span class="secicon fa fa-user"></span>
        </div><!--icon end-->

        <div class="col-sm-11 ">
            <strong style="font-size: 25px;">공약</strong></span>
            <br/>
            <br/>

            <table class="table-responsive">
                <table class="table">
                    <tr class="success">
                        <td ><strong>공약 번호</strong></td>
                        <!-- 국회의원별로 공약이 안 나눠져 있어 번호혼동됨 -->
                        <td><strong>공약 제목</strong></td>
                        <td><strong>공약 설명</strong></td>
                        <td><strong>진행 상태</strong></td>

                        {% for pledge in congressman.pledge_set.all %}
                    <tr>
                        <td>{{pledge.pk}}</td>
                        <td><a href="{% url 'cast:pledge_detail' pledge.id %}">{{ pledge.title }}</a></td>
                        <td>{{pledge.description|truncatechars:10}}</td>
                        <td>{{pledge.get_status_display}}</td>
                    </tr><!-- 두번째 행 -->

                    {% endfor%}
                </table>
            </table>
        </div>
    </div>
</div><!--pledge end-->


<!-- ===========================
BODY RIGHT PART
=========================== -->
<div class="col-md-4 mainright">

    <div class="row mombid">
        <div class="col-sm-1 col-md-2">
            <span class="secicon fa fa-magic"></span>
        </div><!--icon end-->

        <div class="col-sm-11 col-md-10">
            <h3 class="mobmid">공약 신뢰도(공약 이행률)</h3>
            <br/>
            <div class="progress">
                <div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar" style="width:{{ pledge_status.not_enforcement }}%">
                    미시행
                </div>
                <div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar" style="width:{{ pledge_status.progress }}%">
                    진행중
                </div>
                <div class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" style="width:{{ pledge_status.complete }}%">
                    완료
                </div>
                <div class="progress-bar progress-bar-warning progress-bar-striped" role="progressbar" style="width:{{ pledge_status.failed }}%">
                    실패
                </div>
            </div>
        </div><!--tech skills end-->
    </div>

    <hr/>

    <div class="row mobmid">
        <div class="col-sm-1 col-md-2">
            <span class="secicon fa fa-trophy"></span>
        </div><!--icon end-->

        <div class="col-sm-11 col-md-10 ">
            <h3>Awards</h3>

            <div class="award">
                <h4>Best Designer 2012</h4>
                <p class="sub"><a href="">Life View Media Ltd.</a></p>
                <p>Studying all aspect of Graphic Design Including Advertising Design, Branding, Copy Exhibition Design, Ilustration.</p>
            </div>
            <!--1st award end-->

        </div><!--awards end-->

    </div>

</div><!--right end-->
</div>
</div><!--container end. layout과 연결-->

<hr/>


    <button type="button" class="emobtn btn btn-primary" id="like" name="좋아요" value="1" style="color:white;">좋아요</button>
    <button type="button" class="emobtn btn btn-primary" id="dislike" name="싫어요" value="2" style="color:white;">싫어요</button>


<hr/>

    <form action="{% url "cast:comment_new" congressman.pk %}?type=congressman" method="post">
        {% csrf_token %}
        {{ comment_form.message }}
        <input type="submit" class="btn btn-primary btn-block" value="댓글 쓰기" />
    </form>
    <ul>
        {% for comment in congressman.comment_set.all %}
        <li>
            {{ comment.message }}
            <small>by {{ comment.user }}</small>
            {% if comment.user == user %}
                <a href="{% url "cast:comment_edit" comment.pk %}">Edit</a>
                <a href="{% url "cast:comment_delete" comment.pk %}" class="text-danger">Delete</a>
            {% endif %}
            <button type="button" class="comment-emo-btn btn btn-primary" id={{ comment.pk }} name="좋아요" value="1" style="color:white;">좋아요</button>
            <button type="button" class="comment-emo-btn btn btn-primary" id={{ comment.pk }} name="싫어요" value="2" style="color:white;">싫어요</button>
        </li>
        {% endfor %}
    </ul>
<script type="text/javascript">
    // 좋아요 버튼 처리
    // 버튼 클릭 > ajax통신 (like url로 전달) > views의 like 메소드에서 리턴하는 값 전달받기 > 성공시 콜백 호출
    $('.emobtn').click(function(){
        var emotion_name = $(this).attr('value'); // 클릭한 요소의 attribute 중 value 값을 가져온다.

        $.ajax({
            url: "{% url 'cast:congressman_emotion' congressman.pk %}?emotion_name=" + emotion_name, // 통신할 url을 지정한다.
            data: {'csrfmiddlewaretoken': '{{ csrf_token }}'}, // 서버로 데이터를 전송할 때 이 옵션을 사용한다.
            dataType: "json", // 서버측에서 전송한 데이터를 어떤 형식의 데이터로서 해석할 것인가를 지정한다. 없으면 알아서 판단한다.

            success: function(response){
                // 요청이 성공했을 경우 눌려있는 버튼 모양을 바꿔준다.
            },
            error:function(error){
                // 요청이 실패했을 경우
            }
        });
    });


    $('.comment-emo-btn').click(function(){
        var emotion_name = $(this).attr('value'); // 클릭한 요소의 attribute 중 value의 값을 가져온다.
        var comment_pk = $(this).attr('id');

        $.ajax({
            url: "/cast/comment-emotion/"+comment_pk+"/?emotion_name=" + emotion_name, // 통신할 url을 지정한다.
            data: {'csrfmiddlewaretoken': '{{ csrf_token }}'}, // 서버로 데이터를 전송할 때 이 옵션을 사용한다.
            dataType: "json", // 서버측에서 전송한 데이터를 어떤 형식의 데이터로서 해석할 것인가를 지정한다. 없으면 알아서 판단한다.

            success: function(response){
                // 요청이 성공했을 경우 눌려있는 버튼 모양을 바꿔준다.
            },
            error:function(error){
                // 요청이 실패했을 경우
            }
        });
    });
</script>
{% endblock %}
