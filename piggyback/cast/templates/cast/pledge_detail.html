{% extends "cast/layout.html" %}
{% block content %}

    {{ pledge }}
    <button type="button" class="emobtn btn btn-primary" id="like" name="좋아요" value="1" style="color:white;">좋아요</button>
    <button type="button" class="emobtn btn btn-primary" id="dislike" name="싫어요" value="2" style="color:white;">싫어요</button>

<hr/>
    <form action="{% url "cast:comment_new" pledge.pk %}?type=pledge" method="post">
        {% csrf_token %}
        {{ comment_form.message }}
        <input type="submit" class="btn btn-primary btn-block" value="댓글 쓰기" />
    </form>
    <ul>
        {% for comment in pledge.comment_set.all %}
        <li>
            {{ comment.message }}
            <small>by {{ comment.user }}</small>
            {% if comment.user == user %}
                <a href="{% url "cast:comment_edit" comment.pk %}">Edit</a>
                <a href="{% url "cast:comment_delete" comment.pk %}" class="text-danger">Delete</a>
            {% endif %}
            <button type="button" class="comment-emo-btn btn btn-primary" id={{ comment.pk }} name="좋아요" value="1" style="color:white;">좋아요</button>
            <button type="button" class="comment-emo-btn btn btn-primary" id={{ comment.pk }} name="싫어요" value="2" style="color:white;">싫어요</button>
        </li>
        {% endfor %}
    </ul>
<script type="text/javascript">
    // 좋아요 버튼 처리
    // 버튼 클릭 > ajax통신 (like url로 전달) > views의 like 메소드에서 리턴하는 값 전달받기 > 성공시 콜백 호출
    $('.emobtn').click(function(){
        var emotion_name = $(this).attr('value'); // 클릭한 요소의 attribute 중 value 값을 가져온다.

        $.ajax({
            url: "{% url 'cast:pledge_emotion' pledge.pk %}?emotion_name=" + emotion_name, // 통신할 url을 지정한다.
            data: {'csrfmiddlewaretoken': '{{ csrf_token }}'}, // 서버로 데이터를 전송할 때 이 옵션을 사용한다.
            dataType: "json", // 서버측에서 전송한 데이터를 어떤 형식의 데이터로서 해석할 것인가를 지정한다. 없으면 알아서 판단한다.

            success: function(response){
                // 요청이 성공했을 경우 눌려있는 버튼 모양을 바꿔준다.
            },
            error:function(error){
                // 요청이 실패했을 경우
            }
        });
    });


    $('.comment-emo-btn').click(function(){
        var emotion_name = $(this).attr('value'); // 클릭한 요소의 attribute 중 value의 값을 가져온다.
        var comment_pk = $(this).attr('id');

        $.ajax({
            url: "/cast/comment-emotion/"+comment_pk+"/?emotion_name=" + emotion_name, // 통신할 url을 지정한다.
            data: {'csrfmiddlewaretoken': '{{ csrf_token }}'}, // 서버로 데이터를 전송할 때 이 옵션을 사용한다.
            dataType: "json", // 서버측에서 전송한 데이터를 어떤 형식의 데이터로서 해석할 것인가를 지정한다. 없으면 알아서 판단한다.

            success: function(response){
                // 요청이 성공했을 경우 눌려있는 버튼 모양을 바꿔준다.
            },
            error:function(error){
                // 요청이 실패했을 경우
            }
        });
    });
</script>
{% endblock %}




