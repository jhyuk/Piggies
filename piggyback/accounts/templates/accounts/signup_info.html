{% extends 'cast/layout.html' %}

{% load staticfiles %}
{% load socialaccount %}
{% block content %}
  <form action="" method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <select id="city" name="city">
    </select>
    <p>
    <select id="district" name="district">
    </select>
    <input type="submit" value="다음">
  </form>

<script>
  var address; // json 데이터를 불러와 담아놓을 변수
  $(document).ready(function(){
    /*
    페이지 로딩 시 JSON 파일을 불러와 address 변수에 담아 놓고,
    city select box에 시/도 값 표시 default(서울특별시)
    district select box에 서울특별시 행정구 값 표시
    */
    $.getJSON( "{% static 'cast/json/address.json' %}",
      function( data ) {
        address = data;
        city_options = $('#city');
        $.each(address, function( city, val ){
          city_options.append($('<option>',
              { value: city, text: city }
            )) // select box에 option 값 추가
        });
        $('#city').html(city_options.html()); // city select box에 표시

        district_options = $('#district');
        $.each(address['서울특별시'], function( idx, val){
          district_options.append($('<option>',
            { value: val.name, text: val.name }
          ))
        });
        $('#district').html(district_options.html()); // district select box에 표시
      });
  });
  $('#city').change(function(){
    // city select box가 변경 될 경우
    city = $('#city').val();
    district_options = $('#district');
    district_options.empty() // 기본값 설정이 되어있어 append 시 중복되므로 값을 비운다.
    $.each(address[city], function( idx, val){
      district_options.append($('<option>',
          { value: val.name, text: val.name }
        ))
    });
    $('#district').html(district_options.html());
  });

</script>



{% endblock %}
